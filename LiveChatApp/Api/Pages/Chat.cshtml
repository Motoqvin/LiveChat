@page
@{
    ViewData["Title"] = "Chat";
}

<h1 class="mb-4">Chat Room</h1>

<div class="mb-3">
    <input id="user" class="form-control mb-2" placeholder="Enter your username" />
    <input id="msg" class="form-control mb-2" placeholder="Enter your message" />
    <button class="btn btn-primary" onclick="send()">Send</button>
</div>

<ul id="messages" class="list-group"></ul>

<script src="/_framework/aspnetcore-browser-refresh.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chatHub")
        .build();

    connection.on("ReceiveMessage", (msg) => {
        const li = document.createElement("li");
        li.textContent = `${msg.user}: ${msg.message}`;
        li.className = "list-group-item";
        document.getElementById("messages").appendChild(li);
    });

    connection.start().catch(err => console.error(err.toString()));

    function send() {
        const user = document.getElementById("user").value;
        const msg = document.getElementById("msg").value;

        fetch("/send", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ user, message: msg })
        });
    }
</script>
